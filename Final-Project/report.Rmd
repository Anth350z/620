---
title: "Yelp Review Analysis"
author: "Juliann McEachern"
date: "July 17, 2019"
output: 
  html_document:
    theme: paper
    highlight: pygments
    toc: true
    toc_float: true
    toc_depth: 2
    df_print: paged
    code_folding: hide
---


# Final Project 

For the final project, we will be examining the relationship between yelp reviews and businesses in the metropolitan area of Phoenix, Arizona. The data was obtained from Kaggle's 2013 Yelp Review Challenge and was subsetted to include only businesses within the food and beverage industries.

We have a two-part goal in this assignment:

1.  Identify the links between key Yelp users and businesses within the Phoenix, Arizona community.  
2.  Evaluate the relationship between the text contents of reviews and the rating a business received. 

```{r dependencies, echo=F, warning=F, message=F, comment=F}
## data processing packages
library(dplyr); library(tidyr)

##formatting packages
library(knitr); library(kableExtra); library(default)

##network packages
library(igraph)

## knit sizing
options(max.print="100"); opts_knit$set(width=75) 


## augment chunk output
opts_chunk$set(echo=T,cache=F, tidy=T,comment=F,message=T,warning=T) #change message/warning to F upon completion


## set table style for consistency
default(kable) <- list(format="html")
default(kable_styling)  <- list(bootstrap_options = "hover",full_width=T, font_size=10)
default(scroll_box) <- list(width = "100%")
```

## Data Aquisition & Tidying

Data was acquired from Kaggle as a JSON file for a project conducted in [Data 612](http://rpubs.com/jemceach/D212-Final-Project). Our network uses the subsetted data from that project. This subset is stored as a csv file in our data folder and was read into this report for further review.  

```{r aquisition}
# load data
yelp_review <- read.csv("data/yelp_review.csv"); yelp_review <- select(yelp_review,-X)
yelp_user <- read.csv("data/yelp_user.csv"); yelp_user <- select(yelp_user,-X)
yelp_business <- read.csv("data/yelp_business.csv"); yelp_business <- select(yelp_business,-X)
```

## Data Tidying

Explain steps. 

```{r}
# tidy review data
yelp_review$business_id<-as.character(yelp_review$business_id)
yelp_review$user_id<-as.character(yelp_review$user_id)
yelp_review$review_id<-as.character(yelp_review$review_id)
reviews <- yelp_review %>% group_by(business_id) %>% mutate(avg_business_stars = round(mean(stars))) 

# tidy user data
yelp_user$user_id<-as.character(yelp_user$user_id)
user <- yelp_user %>% select(user_id, name) %>% 
  inner_join(yelp_review, by="user_id") %>% 
  select(-date, -review_id)%>%
  group_by(user_id,name) %>% 
  rename(user_name = name) %>%
  summarize(review_count = n(), 
            avg_votes_funny = round(mean(votes.funny, na.rm = TRUE)), 
            avg_votes_useful = round(mean(votes.useful, na.rm = TRUE)), 
            avg_votes_cool = round(mean(votes.cool, na.rm = TRUE)), 
            avg_user_stars = round(mean(stars),1)) %>%
  ungroup()

# tidy business data
yelp_business$business_id<-as.character(yelp_business$business_id)
business <- yelp_business %>% select(business_id, name, categories, city, state, latitude, longitude) %>% rename(business_name = name)

# create relationships from review data between business_id and user_id
relationship <- reviews %>% 
  inner_join(business, by='business_id')%>%
  inner_join(user, by='user_id') %>%
  select(business_id, user_id, business_name, user_name, review_count, avg_business_stars) %>% 
  group_by(business_id) %>% 
  add_count()%>%
  ungroup()
```

Preview relationship data to build network from. 

```{r}
relationship
```


# Network Analysis

Network practice. To be updated.  

```{r network-prep, cache=T}
net <- graph_from_data_frame(d=relationship, directed=T) 
net <- simplify(net, remove.multiple = F, remove.loops = T) 
plot(net,vertex.label=NA)
```

# Text Analysis

Possible reference: https://towardsdatascience.com/sentiment-analysis-with-text-mining-13dd2b33de27

# Conclusion

Final thoughts. 

----------

# References

Inspiration for this project was derrived from the following sources: 

1.  Data Source: https://www.kaggle.com/c/yelp-recsys-2013/data
2.  Related Project: http://rpubs.com/jemceach/D212-Final-Project
3.  R Network Reference: https://kateto.net/network-visualization



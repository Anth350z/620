---
title: "Yelp Review Analysis"
author: "Juliann McEachern"
date: "July 17, 2019"
output: 
  html_document:
    theme: paper
    highlight: pygments
    toc: true
    toc_float: true
    toc_depth: 2
    df_print: paged
    code_folding: hide
---


# Final Project 

For the final project, we will be examining the relationship between yelp reviews and businesses in the metropolitan area of Phoenix, Arizona. The data was obtained from Kaggle's 2013 Yelp Review Challenge and was subsetted to include only businesses within the food and beverage industries.

We have a two-part goal in this assignment:

1.  Identify the links between key Yelp users and businesses within the Phoenix, Arizona community.  
2.  Evaluate the relationship between the text contents of reviews and the rating a business received. 

```{r dependencies, echo=F, warning=F, message=F, comment=F}
## data processing packages
library(dplyr); library(tidyr)

##formatting packages
library(knitr); library(kableExtra); library(default)

##network packages
library(igraph)

## knit sizing
options(max.print="100"); opts_knit$set(width=75) 


## augment chunk output
opts_chunk$set(echo=T,cache=F, tidy=T,comment=F,message=T,warning=T) #change message/warning to F upon completion


## set table style for consistency
default(kable) <- list(format="html")
default(kable_styling)  <- list(bootstrap_options = "hover",full_width=T, font_size=10)
default(scroll_box) <- list(width = "100%")
```

## Data Aquisition & Tidying

Data was acquired from Kaggle as a JSON file for a project conducted in [Data 612](http://rpubs.com/jemceach/D212-Final-Project). Our network uses the subsetted data from that project. This subset is stored as a csv file in our data folder and was read into this report for further review.  

```{r aquisition}
# load data
yelp<- read.csv("data/yelp.csv"); yelp <- select(yelp,-X, -business_id, -user_id) %>% rename(businessID = itemID)
```

## Data Tidying {.tabset .tabset-fade .tabset-pills}

Data was transformed and separated into two dataframes for network building and text processing. 

```{r transformations}
# transform data for network analysis 
yelp_network <- yelp %>% 
  select(userID, businessID, name, stars) %>% 
  group_by(businessID) %>% 
  add_count() %>%
  rename(size = n)%>%
  ungroup() %>%
  group_by(userID) %>% 
  add_count() %>%
  rename(weight = n)%>%
  ungroup()

# transform data for text processing 
yelp_reviews <- yelp %>% 
  transform(reviewID=match(review_id, unique(review_id))) %>% 
  select(-review_id, -longitude, -latitude) %>%
  select(userID, businessID, reviewID, name, city, state, votes.funny, votes.useful, votes.cool, 
         stars, text, date)
```

### Network Data 
```{r view-network-data, echo=F}
yelp_network
```


### Text Data 

```{r view-text-data, echo=F}
yelp_reviews
```


# Network Analysis

We created a 2-mode network from our connections between business entities and yelp users. 

```{r}
# input data 
business_nodes <- unique(yelp_network$businessID)
user_nodes <- unique(yelp_network$userID)
edgeList <- yelp_network %>% select(businessID, userID, weight)

# CREATE GRAPH
g <- graph.empty()

# ADD VERTICES TO GRAPH
## Business Nodes (red)
g <- add.vertices(g, 
                  nv=length(business_nodes), # number of vertices to add 
                  color = 'red',
                  attr=list(name=paste0('B',business_nodes),type=rep(TRUE,length(business_nodes))))
## User Nodes (white)
g <- add.vertices(g,
                  nv=length(user_nodes),
                  color = 'white',
                  attr=list(name=paste0('U',user_nodes), type=rep(FALSE,length(user_nodes))))
## Set Node Shape
V(g)$shape <- ifelse(V(g)$type, "circle", "square")

# CREATE EDGES
## vectorize edge list
edgeListVec <- as.vector(t(as.matrix(data.frame(S1=paste0('B',edgeList$businessID),
                             S2=paste0('U',edgeList$userID)))))
## add edges to graph
g <- add.edges(g,edgeListVec)

## set edge weight attribute
E(g)$weight <- edgeList$weight
E(g)$color <- "black"
```

Verify network bipartite layout and weight attributes.

```{r verify, echo=F}
# VERIFY NETWORK LAYOUT/ATTRIBUTES 
print(paste0("Is Bipartite: ", is.bipartite(g)))
print(paste0("Is Weighted: ", is.weighted(g)))
```


View network: 

```{r}
# plot network (make businesses pink squares and make users blue circles)
plot.igraph(g, 
            layout=layout.bipartite, 
            vertex.frame.color="black",
            vertex.label=NA)

```


# Text Analysis

Possible reference: https://towardsdatascience.com/sentiment-analysis-with-text-mining-13dd2b33de27

# Conclusion

Final thoughts. 

----------

# References

Inspiration for this project was derrived from the following sources: 

1.  Data Source: https://www.kaggle.com/c/yelp-recsys-2013/data
2.  Related Project: http://rpubs.com/jemceach/D612-Final-Project
3.  R Network Reference: https://kateto.net/network-visualization


